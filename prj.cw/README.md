# ShadowSegmentation

Консольное приложение для автоматической сегментации теней на изображениях

---

## Описание

ShadowSegmentation — это приложение на C++ для выделения теней на изображениях с помощью классических методов компьютерного зрения. Алгоритм основан на анализе яркости (V-канал HSV), морфологических операциях и фильтрации по площади. Все этапы обработки сохраняются для отладки.

---

## Основные этапы алгоритма

1. **Преобразование в HSV**
   - Изображение переводится в цветовое пространство HSV.

2. **Пороговая сегментация по яркости**
   - Строится бинарная маска: пиксели с яркостью (V) ниже заданного порога считаются тенями.

3. **Морфологическая обработка**
   - Применяется морфологическое закрытие (close) для заполнения дыр.
   - Затем морфологическое открытие (open) для удаления мелких шумов.

4. **Фильтрация по площади**
   - Оставляются только области, площадь которых превышает заданный минимум.

5. **Debug-вывод**
   - На каждом этапе сохраняются промежуточные изображения с пронумерованными именами:
     - `1_input.jpg` — исходное изображение
     - `2_v_mask.jpg` — бинарная маска по V-каналу
     - `3_v_mask_close.jpg` — после закрытия
     - `4_v_mask_open.jpg` — после открытия
     - `5_filtered.jpg` — после фильтрации по площади
     - `6_final_overlay.jpg` — итоговая маска, наложенная на исходное изображение

---

## Требования

- C++17
- OpenCV 4.x
- CMake 3.10+
- Windows 10/11

---

## Сборка

1. Установите OpenCV 4.x и добавьте путь к библиотекам в переменную среды PATH.
2. Установите CMake 3.10+.
3. Клонируйте репозиторий и перейдите в папку проекта:

```sh
git clone <URL-репозитория>
cd prj.cw
```

4. Соберите проект:

```sh
mkdir build && cd build
cmake .. -G "Visual Studio 17 2022" -A x64
cmake --build . --config Release
```

---

## Использование

### Обработка одного изображения

```sh
ShadowSegmentation.exe path/to/image.jpg
```

### Пакетная обработка и debug-вывод

- Для пакетной обработки используйте скрипт `run_debug.bat`.
- Все промежуточные этапы сохраняются в папку `debug_output/имя_изображения`.

---

## Настройка параметров

Все параметры (порог V, размер ядра морфологии, минимальная площадь) настраиваются в конструкторе класса `ShadowLedentifier`.

---

## Пример вызова

```sh
ShadowSegmentation.exe examples/shadow1.jpg
```

---

## Примечания

- Алгоритм не использует LAB, majority voting или сложные признаки — только V-канал HSV, морфология и фильтрация по площади.
- Для анализа качества работы используйте сохранённые debug-изображения по этапам.
